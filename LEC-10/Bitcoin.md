## Bitcoin

Bitcoin：A Peer-to-Peer Electronic Cash System，由Satoshi Nakamoto，2008

比特币：
  数字货币
  一个公共分类帐，以防止双重支出
  没有集中的信任或机制< - 这很难！

为什么人们想要数字货币？
  可能会使在线支付更容易
  信用卡运作良好但并不完美
    不安全 - >欺诈 - >费用，限制，倒转
    所有购买记录

技术上有什么困难？
  伪造品
  双重支出
  盗窃

社会/经济上有什么困难？
  为什么比特币有价值？
  如何支付基础设施？
  货币政策（有意通货膨胀和c）
  法律（税收，洗钱，毒品，恐怖分子）

想法：签署顺序的交易
  （这是比特币的直接部分）
  有一堆硬币，每个都由某人拥有
  每个硬币都有一系列交易记录
    每一次这个硬币被转移作为付款
  硬币的最新交易表明现在是谁拥有的

交易记录是什么？
  pub（user1）：新主人的公钥
  hash（prev）：这个硬币以前的交易记录的哈希值
  sig（user2）：以前所有者的私钥对交易签名
  （BitCoin更复杂：数量（分数），多进/出，...）

交易示例：
  Y拥有一个硬币，以前由X给它：
    T7：酒吧（Y），散列（T6），信号（X）
  Y从Z购买一个汉堡包，并用这个硬币支付
    Z向Y发送公钥
    Y创建一个新的交易并签收
    T8：酒吧（Z），散列（T7），sig（Y）
  Y将交易记录发送给Z
  Z验证：
    T8的sig（）对应于T7的酒吧（）
  Z给Y的汉堡包

Z的“余额”是Z知道私钥的未经营交易的集合
  硬币的“身份”是其最近的xaction的（哈希）
  Z“拥有”硬币= Z知道最新xaction中的“新所有者”公钥的私钥

所有人以外的任何人都可以用硬币吗？
  当前所有者的私钥需要签署下一个事务
  危险：攻击者可以窃取Z的私钥，例如从PC或智能手机窃取

硬币的所有者可以在这个方案中花两次钱？
  Y创造两笔交易：Y-> Z，Y-> Q
    都有哈希（T7）
  Y对Z和Q显示不同的交易
  这两个交易看起来都很好，包括签名和哈希
  现在Z和Q都会把汉堡包给Y

为什么双重支出成为可能？
  b / c Z和Q不知道完整的交易集

我们需要什么？
  以相同的顺序将所有交易的日志发布给所有人
    所以Q知道Y-> Z，并且将拒绝Y-> Q
    “公开分类帐”
  确保Y不能取消发布交易

为什么不依靠花旗银行或美联储来发布交易？
  不是每个人都相信他们
  他们可能会倾向于扭转或限制

为什么不发布这样的交易：
  1000人的同龄人，由任何人管理，任何一个对等体都不需要任何信任
  同伴们通过“覆盖”来涌现新交易
  交易Y-> Z只有大多数同业认为有效才可以接受
    即他们不知道Y-> Q
    希望大多数重叠确保检测到双重支出
  如何计票？
    如何平等对等，你知道多数是多少？
    也许不同的IP地址？
  问题：“sybil攻击”
    IP地址不安全 - 易于伪造
    攻击者假装拥有10,000台电脑 - 多数
    当Z问，攻击者的多数说“我们只知道Y-> Z”
    当Q问，攻击者的多数说“我们只知道Y-> Q”
  投票是很难在“开放”p2p方案

BitCoin块链
  目标：交易日志协议，以防止双重支出
  块链包含所有硬币上的交易
  许多同行
    每个都有整个链的完整副本
    提议的交易淹没给所有同行
    新区块涌向所有同行
  每个块：
    哈希（prevblock）
    一套交易
    “nonce”（在通常的加密意义上不是一个随机的）
    当前时间（挂钟时间戳）
  新块每隔10分钟包含自从上一个块以来的xaction
  收款人不会相信交易，直到它在块链

谁创建每个新的块？
  这是“采矿”
  所有同行尝试
  要求：哈希（块）具有N个前导零
  每个对等体尝试随机值，直到出现这种情况
  尝试一个随机数是快的，但大多数的随机数将不起作用
    这就像翻转一个十亿分之一的硬币直到头顶
    每个翻转都有独立（小）的成功机会
    挖掘块*不*特定固定的工作量
  可能需要一个CPU时间来创建一个块
  但是成千上万的同行正在努力
  这样预期的时间首先要找到大约10分钟
  获胜者将新区块淹没给所有同行

Y-> Z交易如何工作？
  开始：所有的同行知道... < -  B5
    并正在B6（尝试不同的随身听）
  Y将Y-> Z交易发送给对等体，从而对其进行泛滥
  对等体缓冲事务直到B6计算
  听到Y-> Z的同行包括在下一个块中
  所以最终... < -  B5 <-B6 <-B7，其中B7包括Y-> Z

如果Y同时发出Y→Z和Y→Q？
  即Y尝试双重支出
  没有正确的对等体将接受两者，所以块将具有一个但不是两者

问：B6会有两个不同的继承人吗？

如果Y告诉一些同行关于Y-> Z，其他人关于Y-> Q会发生什么？
  也许使用网络DoS以防止完全洪水
  也许会有一个叉子：B6 <-BZ和B6 <-BQ

分叉链如何解决？
  每个对手最初都相信BZ / BQ中首先看到的
  试图创建一个继任者
  如果BZ比BQ还多，BZ将会更多，
    所以BZ接班人很可能先创建
  如果正好半个半，一个叉可能首先被延长
    因为采矿成功时间有重大变化
  同行们始终切换到挖掘最长的叉，重新达成协议

从而：
  临时双重支出是可能的，由于叉
  但是叉子的一侧或另一侧很可能消失
  因此，如果Z看到Y-> Z后有几个块，
    它不太可能被a超过
    不同的叉包含Y-> Q
  如果Z销售高价值物品，Z应该等待几个
    运送前块
  如果Z卖东西很便宜，也许可以等一下同行
    看到Y-> Z并验证它（但不是块）

攻击者可以修改块链中间的块吗？
  不直接，因为后续块保持块的哈希

可以攻击者从一个旧的块开始一个叉，Y-> Q而不是Y-> Z？
  是的 - 但是叉子必须更长才能让同行接受它
  所以如果攻击者在后面启动N个块，则必须生成N + M + 1
    在主叉之前叉子上的块被M延伸
  即攻击者必须比其他对手更快地挖掘块*
  只有一个CPU，将需要几个月创建甚至几个块
    那时候，主链将会更长
    没有对等体将切换到攻击者的较短链
  如果攻击者有1000多个CPU  - 超过所有诚实
    比特币同行 - 那么攻击者可以创建最长的分支，
    每个人都会切换到它，允许攻击者双重支出

这里有一个多数投票系统
  同行通过采矿投票延长最长的连锁
 
概要：
  如果攻击者控制CPU的大部分权力，可以强制实行
    对等体从真实链转换为由攻击者创建的链
  否则不

验证检查：
  同行，新xaction：
    没有其他交易花费相同的以前的交易
    签名是以前的交易中的pub密钥的私钥
    那么将添加事务到txn列表中的下一个块我的
  对等，新块：
    哈希值具有足够的前导零（即随机数是正确的，证明工作）
    存在先前的块哈希
    块中的所有交易均有效
    如果比当前最长的时间更长，则对等体切换到新链
  Z：
    （有些客户依靠同行做上述检查，有些不行）
    Y-> Z在一个块中
    Z的公钥/地址在交易中
    链中还有几个块
  （其他东西也必须检查，很多细节）

每个比特币最初来自哪里？
  每次一个同伴挖一个块，它得到12.5位比特币（当前）
  它将其公钥放在块中的特殊交易中
  这是激励人们操作比特币的同行

问：如果许多矿工加入，如何创建更快的块？

问：10分钟是烦人的 可以做得更短吗？

问：交易是匿名的吗？

问：如果我偷比特币，可以安全的花费吗？

问：可以伪装比特币，即一个完全假的硬币？

问：世界上大多数CPU电源对手能做什么？
   可以通过分叉双重花费和不花费
   不能偷他人的比特币
   可以防止xaction进入链

问：如果块格式需要改变怎么办？
   如果新格式对于以前的s / w版本是不能接受的呢？

问：同伴如何找到对方？

问：如果同伴被骗到只与腐败的同伴交谈？
   如果它与一个好的同伴谈话和许多勾结的坏同行呢？

问：一个全新的同行可能被骗到完全使用错链吗？
   如果一个对等人在几年的连线后重新加入呢？
   几天断线？

问：一台机床采矿有多贵？

问：为什么随着时间的推移矿业报酬减少是有道理的？

问：这是一个固定数量的硬币的问题吗？
   如果实体经济增长（或收缩）呢？

问：为什么比特币有价值？
   例如，1 2017年1个BTC似乎约为1400美元。

问：比特币会很好吗？
   随着交易率的上升？
     要求CPU限制为4,000 tps（签名检查）
     超过Visa但不到现金
   随着块链长度的增加？
     你有没有需要看看旧的街区？
     你有没有需要xfer整个块链？
     merkle树：块头与txn数据。
   可悲的是，最大块大小限制为1兆字节

问：比特币是否只是一个不含新货币的分类帐？
   例如有美元是货币？ 
   因为货币部分很尴尬。
   （结算...矿业激励...）

关键思想：块链
  公共分类帐是一个好主意
  权力下放可能会很好
  挖掘是一种避免sybil攻击的聪明方式
  将分类帐到新货币似乎很尴尬，也许是必要的